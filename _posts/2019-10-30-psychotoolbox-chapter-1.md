---
layout: post
title: "Chapter1: Matlab 概述和编程基础"
subtitle: "预备"
date: 2019-10-30
author: Lu Nie 
category: Psychotoolbox 
tags: Experimental-Design 
finished: true 
---

> ### 编程环境
> ### 编程语言
> ### 矩阵基础和运算、
> ### matlab 程序设计基础
> ### 实验设计常用的Matlab函数

#### 1. 编程环境
>**命令窗口**
* 命令窗口中我们可以直接输入Matlab代码并执行。
* 常用来测试简单的代码，查询Matlab自带的函数，或者对正在运行的代码进行中断操作；或是在运行某些需要输入参数的代码时，也在命令窗口进行。
* 换言之，通常情况下，是在编辑器当中去完成代码。
>**工作空间**
* 工作空间用于保存代码执行时的所有变量。
* 查看--whos X（变量）class 函数 （询问），isa函数 (判断)
* 保存工作空间中的变量 — save ws a b; 将变量a b保存到名为ws.mat 文件中
* 清除— clear 
* 将保存的变量再次读取到工作空间中 load ws 
* 保存已经编写的代码 diary 函数 — diary off 终点
>**编辑器**
* 最重要！用于编写和调试Matlab代码，并将其保存为扩展名为”.m”的文件

#### 2. 编程语言
>变量
* 命名规则
>数据类型
* 整型
* 浮点型
* 字符型
* 逻辑型：用于判断一段语句是否正确
* 结构体:可以包含多种不同的数据类型。如，实验中，记录被试的name，RT, accuracy； 
操作如下：
         Response.Name=‘Lulu’
         Response.Time=240.5
         Response.accuracy=0.98 
        此时的Response 为一个结构体。[  ]
* 元胞：{} 注意索引方式与结构体有差别
* cell的两种创建方式：指定陈述 & cell函数
* 函数句柄：通常用于间接调用一个函数的取值或者数据类型。常用于作图过程中对图片的不同属性进行操作。
>矩阵基础
* 矩阵通过[中括号]定义，一个中括号定义一个矩阵，区分列--n, and 空格; 区分列--; 
* 提取矩阵中的元素：采用矩阵索引，定位到要提取的元素所在的行，列即可。另外，还有采用”:”和”end”的方法。
* 多维矩阵的定义： (行，列，页): 在每一页上去定义行、列。多维矩阵也可以用cat()串联函数进行构造
> 矩阵运算
* 加：“+” 两个矩阵内对应位置的元素值之和
* 减：“-”
* 乘法:“*” 服从矩阵相乘的规则 不是一一对应
* 除: 左除(/)，右除(\)
* 乘方：“^”
* 转置：“‘”行列互换
* 数组乘法（点乘）”.*” 两个矩阵中对应位置的元素点点相乘
* 数组除法（左点除，右点除）点点相除
* 数组乘方（点乘方）矩阵中的元素独立进行乘方运算

除了以上运算符，可以使用各运算对应的函数进行运算
>关系运算：实则是矩阵中，各元素点对点的关系判断，返回的是逻辑变量0(假),1（真）
* 大于 >
* 小于 <
* 大于等于 >=
* 小于等于<=
* == 等于
* ~=不等于
* & 与
* | 或
* 短路逻辑与（&&）逐个判断每个对象。一旦遇到某个对象是假，不再继续，直接返回假
* 短路逻辑或（||）逐个判断每个对象。一旦遇到某个对象是真，不再继续，直接返回真
* ~ 非
注意：计算有优先级
* （1）转置、乘方、数组乘方
* （2）逻辑非
* （3）矩阵乘除法、数组乘除法
* （4）矩阵加减法、数组加减法
#### 3.Matlab程序设计基础 （程序的创建和程序的调试）
##### 1.程序的创建
程序的创建其实就是在新建一个m.文件，并在其中进行代码编写。快捷键：命令窗口中敲入: edit 即可打开编辑器。Matlab程序文件包括两种：m文件和函数function
> script : 
* 脚本文件  和函数不同的是，脚本能够将程序中所定义的变量完整保存在工作空间，方便查看程序运行结果。
*  通常用于编写单次使用的程序。
> function：是通过Matlab函数所要求的一定格式进行编写并保存的m文件；
* 通过函数定义的变量，在函数运行结束后不会保存在工作空间中 。
* 调用方便，通常用于编写多次使用的程序。
**永久性函数**：可以在编辑器中编写并保存，并可以在命令窗口和其他m文件中进行调用。通过function语句指引，格式为：
* function [out1,out2,…] = FunName(input1, input2, …)
                 % 注释说明部分 （函数中的注释部分，可以通过help指令显示出来）
                 函数体语句
* 永久性函数的命名规则和变量名相同，最好和m文件名一致，并且必须保存在单一的m文件中。函数输出参数中提到的变量（e.g. Out1, out2…）要在函数体中予以赋值。自定义函数的编写要避面与系统自带的函数名重复。
**临时性函数**：包括内联函数（inline function）和匿名函数（anonymous function）后者效率更高。临时性函数常用于创建需要临时使用的简单函数。
**子函数**：当我们在编写函数的时候，可能会遇到需要在此函数脚本中调用一个固定程序（此时，该固定程序可以写为函数）。换言之，就是需要在函数中调用函数（可以是永久或是暂时，可以是Matlab自带，也可以是自定义的）。这时，该脚本本身的函数就是主函数，其他别调用来服务的，就是子函数。子函数可以被同一函数文件中的主函数和其他子函数调用：注意是同一函数文件！
    * 在包含子函数的文件中，每个function要配一个end
    * 子函数的使用使得主函数变得清晰明朗。
函数的递归： 函数自己调用自己 （注意陷入无限循环）
##### 2.程序的调试 debug
> 简单的调试
* 脚本：逐句运行
* 函数：(keyboard - return) 函数中的变量是不会存储到变量空间的，所以，需要在适当的地方加入keyboard指令，增加程序的交互性：程序运行到keyboard指令时会出现暂停，命令窗口出现提示符”K>>”,此时我们可以查看和修改中间变量的取值。结束查看：输入return > enter 
> 设置程序断点 breakpoint 
* 在脚本中，对应需要设置断点的行数，单击鼠标，会出现一个红点，表示断点位置。断点所在行的指令尚未执行。此时我们可以在工作空间中查看程序中变量的取值，也可以在命令窗口中输入指令以辅助调试代码，更重要的，这表明断点以前的代码能够正常运行。
* 利用 breakpoint + step （对应图标）可以逐行运行代码。
* 注意：修改代码之前需要退出断点调试，修改并保存后才可以重新开始调试。
* 断点调试常用功能
* 补充：清除所有断点，快捷键为： 命令窗口 dbclear all 

#### 4.实验设计常用函数

心理学实验设计编程通常需要的主要步骤：
* 实验设计的试次；
* 编写实验刺激
* 呈现实验刺激
* 输出实验结果

> 设计实验的trial ——随机函数
* rand: 生成[0 1]之间均匀分布的浮点随机数
* rand(2,3)： 生成一个2*3的随机矩阵
* randi(n)：生成一个[1,n]之间均匀分布的随机整数
* randi(10,2,3): 生成一个范围在[1 10]的大小为2*3的随机整数矩阵
* randn：生成标准正态分布的随机数； randn(2,3): 生成2*3标准正态分布矩阵
* 产生两组完全一样的随机数或者随机矩阵：设置随机数种子  rand (’seed’, seed)的使用。用于当实验要求不同的实验被试采用同样的实验trial顺序时。
> 设计实验的trial——将序列进行随机排列
* randperm (n)函数 对1到n之间的正整数进行随机排列
* Shuffle 函数(这个是psychtoolbox的函数)：用于对数组或是矩阵排列，可用于对矩阵的每一列进行独立的随机排列 
> 编写实验刺激
* **特殊矩阵生成方式**
**zeros** 
**ones**
**eye** 单位矩阵
**diag** 对角矩阵
**rand** 随机矩阵
**randn** 随机整数矩阵
**magic** 魔方矩阵
* **对矩阵进行计算的函数**
**abs**: 计算绝对值
**sin/sind**: 计算正弦函数值
**cos/cosd**: 计算余弦函数值
**tan/tand**：计算正切函数值
**round/floor/ceil**: 四舍五入取整 / 向负无穷方向取整/向正无穷方向取整
**min/max/mean/std**
**range** 计算极差
**sign**判断正负号
**注意**：
* sin/sind;cos/cosd 之类的函数，变量是角度还是弧度
* max(): max一个矩阵的时候，返回每一列的最大值；如果max一个向量，返回的是该行的最大值。二者结合，可以求整个矩阵的最大值max(max(A)) = max(A(: )): 冒号的作用是先将A中所有元素排成一列。mean（）函数也有类似用法。
* **对矩阵进行操作的函数**
**sort** 排序
**sortrows** 按照关键列进行排序
**rot90** 逆时针旋转
...
还有很多，需要的时候查阅
**呈现实验刺激——判断类函数**
* 函数 isempty()， 是可以直接对变量是否为空值进行判断，返回逻辑值0或者1；
**输出实验结果——转化操作、路径和文件操作**
* （当需要根据不同的需求保存不同类型的数据，以及对于文件的保存路径和文件本身的操作时）：
**常见的转化操作函数**
* 函数num2str(X, FORMAT), 此处format的格式规则，与之前的 sprintf() 类似
* 函数int8() 特别适用在保存图片的时候
* 常见的路径和文件操作函数：方便的存储和读取文件